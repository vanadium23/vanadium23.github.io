
  
  
<!DOCTYPE html>
<html lang="ru-ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Выдержка из книги &#34;Architecturing for Scale&#34; | vanadium23</title>
  <meta name="author" content="vanadium23" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:creator" content="@vanadium23" />
    <meta property="og:title" content="Выдержка из книги &#34;Architecturing for Scale&#34;" />
    <meta property="twitter:title" content="Выдержка из книги &#34;Architecturing for Scale&#34;" />
    <meta name="description" content="Книга мне понравилась своей лаконичностью так, что советую прочитать чеклист на основе её и сделать вывод хотите ли вы читать её полностью. Весь чек лист разбит на основе оглавления из книги, поэтому можете читать выборочно.">
    <meta property="og:description" content="Книга мне понравилась своей лаконичностью так, что советую прочитать чеклист на основе её и сделать вывод хотите ли вы читать её полностью. Весь чек лист разбит на основе оглавления из книги, поэтому можете читать выборочно." />
    
  <link rel="stylesheet" href="https://vanadium23.me/css/base.min.a3368a1810ce5f531d4379f7ef2a70a442d894fcc461091bac1ea3cfee39833c.css" integrity="sha256-ozaKGBDOX1MdQ3n37ypwpELYlPzEYQkbrB6jz&#43;45gzw=">
  <link rel="stylesheet" href="https://vanadium23.me/css/likely.css" integrity="">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <meta name="generator" content="Hugo 0.68.3" />
</head>
<body>
  <nav class="u-background">
    <div class="u-wrapper Banner">
        <a class="Banner-link u-clickable" href="https://vanadium23.me/">
            vanadium23
        </a>
        <ul class="Banner">
        
        <li class="Banner-item">
            <a class="Banner-link u-clickable" href="https://vanadium23.me/about/">About</a>
        </li class="Banner-item">
        
        <li class="Banner-item">
            <a class="Banner-link u-clickable" href="https://vanadium23.me/tags/">Tags</a>
        </li class="Banner-item">
        
        <li>
            <a id="themeSwitch" class="theme-switcher"></a>
        </li>
        </ul>
    </div>
</nav>
  <main >
    <div class="u-wrapper">
      <div class="u-padding">
        

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://vanadium23.me/architecting-for-scale/" rel="bookmark">Выдержка из книги &#34;Architecturing for Scale&#34;</a>
  </h2>
  <div class="Heading-additional">
    
    <time datetime="2019-03-15T17:00:00&#43;03:00">
      15 March, 2019
    </time>&middot;
    
  
  <span>4 min read</span>
  
  </div>
</header>
  <p><a href="https://www.goodreads.com/book/show/38096544">Книга</a> мне понравилась своей лаконичностью так, что советую прочитать чеклист на основе её и сделать вывод хотите ли вы читать её полностью. Весь чек лист разбит на основе оглавления из книги, поэтому можете читать выборочно.</p>
<p><em>Здесь и далее следует понимать, что все примеры старались проводиться либо из опыта, либо на основе типичного магазина по продаже футболок</em></p>
<h2 id="доступность">Доступность</h2>
<h3 id="в-чем-разница-между-надежностью-и-доступностью">В чем разница между надежностью и доступностью?</h3>
<ul>
<li>Надежность - способность системы выполнять требуемые действия, не допуская ошибок.</li>
<li>Доступность - готовность системы к работе при необходимости выполнить требуемые действия.</li>
</ul>
<h3 id="как-улучшить-доступность">Как улучшить доступность?</h3>
<ol>
<li>Учитывайте возможные отказы</li>
<li>Всегда помните о масштабировании (прим. от меня и ограничениях)</li>
<li>Смягчайте последствия рисков (понравился пример что если не работает поиск на сайте футболок, выдавайте временно топ предложения)</li>
<li>Контролируйте доступность (== мониторинг)</li>
<li>Disaster recovery policy (прим. от меня старайтесь строить self-recovering processes в системах)</li>
</ol>
<h3 id="какая-доступность-является-нормальная">Какая доступность является нормальная?</h3>
<p>Определите сами на основе таблицы:
99%     - 432 минуты даунтайма в месяц
99,9%   - 43 минуты
99,99%  - 4 минуты
99,999% - 26 секунд</p>
<h2 id="управление-рисками">Управление рисками</h2>
<h3 id="принцип-управления-рисками">Принцип управления рисками</h3>
<ol>
<li>Составить матрицу рисков (<a href="https://www.architectingforscale.com/files/Risk%20Matrix%20Template.xlsx">шаблон</a>)
<ul>
<li>Важно понимать, что у риска есть вероятность и критичность, для этого примеры:
<ul>
<li>Список топ-10 футболок: низкая вероятность и низкая критичность.</li>
<li>База данных с заказами: низкая вероятность и высокая критичность.</li>
<li>Загрузка сторонних шрифтов: высокая вероятность и низкая критичность.</li>
<li>Фотографии футболок: высокая вероятность и высокая критичность.</li>
</ul>
</li>
</ul>
</li>
<li>Ликвидация самых опасных рисков.</li>
<li>Смягчение последствий рисков, которые нельзя исключить.</li>
<li>Итерируй матрицу рисков или см п.1</li>
</ol>
<p>Дальше в главе написано примеры конкретных действий по каждому из пунктов.
Из интересного забавным показалось, что можем сделать запас на 6 серверов приложения, но они все в одной стойке/питании и на самом деле это не резервирование. (Привет, Selectel)</p>
<h2 id="сервисы">Сервисы</h2>
<h3 id="что-такое-сервис">Что такое сервис</h3>
<ol>
<li>Собственная кодовая база</li>
<li>Управлять собственными данными</li>
<li>Предоставлять возможности другим сервисам</li>
<li>Пользоваться возможностями других сервисов</li>
<li>Иметь единственного владельца-команду.
<ul>
<li>В книге уточняется что одна команда может владеть несколькими сервисами, но не наоборот. (P.s. не согласен полностью)</li>
</ul>
</li>
</ol>
<h3 id="как-делить">Как делить</h3>
<ol>
<li>Разделение по бизнес-требованиям (legal, security)</li>
<li>Разделение по зонам ответственности (management)</li>
<li>Разделение по роду данных (domain)</li>
<li>Разделение возможностей или информации (reusable apps)</li>
</ol>
<h3 id="сложности">Сложности</h3>
<ol>
<li>Нет общей картины</li>
<li>Благоприятная среда для сбоев и ошибок</li>
<li>Сложно внести изменения</li>
<li>Возрастает количество зависимостей</li>
</ol>
<p>Была отдельная большая глава про обработку ошибок от сервисов и постепенной деградации.</p>
<h2 id="масштабирование-сервисов">Масштабирование сервисов</h2>
<h3 id="запас-на-две-ошибки">Запас на две ошибки</h3>
<p>Правило лётчиков в том, что если ты не можешь сделать манёвр, то у тебя должен быть запас высоты на две ошибки.
Очень клёвое правило и дальше были простые вычисления для примера:
Есть сервис на 300 rps, сколько нужно узлов для 1000 rps?
Очевидный ответ - 4 (1000/300 ~ 3.33, ближайшее целое 4), но в этой ситуации при выходе из строя ноды каждая получает 333 rps и это вызовет каскадный отказ. При 5 узлах мы начинаем работать когда вышибает одну ноду, но если идёт деплой и вышибло одну ноду, то снова скатываемся в предыдущую ситуацию, поэтому идеально иметь запас на две ошибки.</p>
<h3 id="домашка">Домашка</h3>
<p>Сколько нужно узлов для обработки 10000 rps, если одна нода обрабатывает 300 rps?
Если у нас два датацентра и нам необходимо обеспечить отказ на уровне датацентра?
А если у нас 6 дата центров? :)</p>
<h3 id="владение-сервисами">Владение сервисами</h3>
<ul>
<li>Все сервисы закреплены за командами разработки</li>
<li>Ни один сервис не закреплен за несколькими командами</li>
<li>Команда может отвечать за несколько сервисов</li>
<li>На командах полный цикл: от архитектуры до мониторинга и решения проблем</li>
<li>Между сервисами есть четкие границы и документированное API</li>
<li>Между сервисами установлено SLA, о нарушениях которых оповещается команда-владелец</li>
</ul>
<h3 id="классы-сервисов">Классы сервисов</h3>
<p>Класс сервиса - это метка присвоенная, сервису которая означает насколько важен данный сервис для функционирования бизнеса.</p>
<ul>
<li>Класс 1 - тяжелые последствия, пример: сервис обработки заказов</li>
<li>Класс 2 - неприятное взаимодействие с сервисом для клиента, пример: сервис поиска</li>
<li>Класс 3 - незаметное или почти незаметное взаимодействие, пример: сервис рекомендаций</li>
<li>Класс 4 - никакого негативного влияния на клиентов, пример: сервис генерации отчётов</li>
</ul>
<h3 id="использование-классов-сервисов">Использование классов сервисов</h3>
<ul>
<li>Ожидания - какая у сервиса должна быть надёжность и доступность?</li>
<li>Реагирование - насколько быстро надо реагировать на проблему в сервисе?</li>
<li>Зависимости - какие классы у сервисов от которых зависите? Как мы должны обрабатывать отказы: деградировать или умирать?</li>
</ul>
<h3 id="sla">SLA</h3>
<p>Почему SLA важны и особенно внутренние?</p>
<ul>
<li>Создание доверия</li>
<li>Упрощение диагностики проблем</li>
<li>Измерение производительности</li>
</ul>
<p>Как ставить SLA?</p>
<ul>
<li>SLA должны быть релевантны потребителям иначе они не SLA</li>
<li>Желательно, иметь как можно меньше метрик</li>
<li>Желательно, иметь одни SLA на всех потребителей</li>
</ul>
<p>Примеры SLA про магазин высокоуровнего:</p>
<ul>
<li>Доступность - &ldquo;наш магазин доступен не менее чем 99,4% времени&rdquo;</li>
<li>Время загрузки - &ldquo;страницы открываются менее чем за 4 с в 99% случаях&rdquo;</li>
<li>Продукты - &ldquo;как минимум 80% наших товаров в каталоге находится на складе&rdquo;</li>
</ul>
<h2 id="облачные-сервисы">Облачные сервисы</h2>
<p>Там было про AWS, Lambda и прочее. Похоже на маркетинговый булшит, ничего полезного.</p>
<h2 id="вопросы-к-сервисам-на-основе-предложенной-книги">Вопросы к сервисам на основе предложенной книги</h2>
<ol>
<li>Есть ли у вас матрица рисков?</li>
<li>Есть ли SLA для сервисов?</li>
<li>Есть ли несколько команд, которые владеют одним сервисом?</li>
</ol>
  
    <div class="likely likely-big" data-url="https://vanadium23.me/architecting-for-scale/">
    <div class="twitter" data-via="vanadium23">Tweet</div>
    <div class="facebook">Share</div>
    <div class="vkontakte">Share</div>
    <div class="telegram">Send</div>
</div>

  
  
<footer>
  <ul class="Tags">
    
    
    
    <li class="Tags-item u-background">
      <a class="Tags-link u-clickable" href="https://vanadium23.me/tags/blog/" rel="tag">blog</a>
    </li>
    
    
    
    
    <li class="Tags-item u-background">
      <a class="Tags-link u-clickable" href="https://vanadium23.me/tags/book/" rel="tag">book</a>
    </li>
    
    
  </ul>
</footer>

</article>


      </div>
    </div>
  </main>
  <footer class="Footer">
  <div class="u-wrapper">
    <div class="u-padding">
        
        <a href="https://github.com/vanadium23"><i class="svg-icon github"></i></a>
        <a href="https://www.linkedin.com/in/vanadium23"><i class="svg-icon linkedin"></i></a>
        <a href="https://www.twitter.com/vanadium23"><i class="svg-icon twitter"></i></a>
        <a href="http://stackoverflow.com/users/4809450/vanadium23"><i class="svg-icon stackoverflow"></i></a>
        <a href="https://www.codewars.com/users/vanadium23"><i class="svg-icon codewars"></i></a>
        <a href="https://goodreads.com/vanadium23"><i class="svg-icon goodreads"></i></a>
    </div>
  </div>
</footer>
  
  <script type="text/javascript" src="https://vanadium23.me/js/likely.js" integrity=""></script>
  <script type="text/javascript" src="https://vanadium23.me/js/themes.js" integrity=""></script>
</body>
</html>